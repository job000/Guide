<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Frontend, Proxy & Backend Kommunikasjon - Obligar Consulting</title>
  <link rel="stylesheet" href="../assets/styles.css">
  <style>
    .architecture-diagram {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: #e2e8f0;
      padding: 2rem;
      border-radius: 16px;
      margin: 2rem 0;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      overflow-x: auto;
    }
    .architecture-diagram h3 {
      color: #60a5fa;
      margin-top: 0;
      border: none;
    }
    .architecture-diagram h3::before { display: none; }
    .flow-diagram {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      border: 2px solid #334155;
      border-radius: 16px;
      padding: 2rem;
      margin: 2rem 0;
      overflow-x: auto;
    }
    .flow-box {
      display: inline-block;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      text-align: center;
      min-width: 120px;
    }
    .flow-frontend { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
    .flow-proxy { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
    .flow-backend { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; }
    .flow-database { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
    .flow-arrow {
      display: inline-block;
      color: #60a5fa;
      font-size: 1.5rem;
      margin: 0 1rem;
      vertical-align: middle;
    }
    .file-path {
      background: #1e293b;
      color: #60a5fa;
      padding: 0.5rem 1rem;
      border-radius: 8px 8px 0 0;
      font-family: monospace;
      font-size: 0.85rem;
      margin-bottom: 0;
      display: inline-block;
    }
    .file-path + pre {
      margin-top: 0;
      border-radius: 0 8px 8px 8px;
    }
    .concept-card {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1rem 0;
      transition: all 0.3s;
    }
    .concept-card:hover {
      border-color: #3b82f6;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
    }
    .concept-card h4 {
      margin: 0 0 0.5rem 0;
      color: #1e40af;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .concept-card h4::before { display: none; }
    .concept-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }
    .quick-nav {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 1.5rem;
      margin: 2rem 0;
    }
    .quick-nav a {
      display: inline-block;
      margin: 0.25rem;
      padding: 0.5rem 1rem;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.9rem;
      text-decoration: none;
      color: #334155;
    }
    .quick-nav a:hover {
      border-color: #3b82f6;
      background: #eff6ff;
      color: #1e40af;
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
    }
    .comparison-table th {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      padding: 1rem;
      text-align: left;
    }
    .comparison-table td {
      padding: 1rem;
      border-bottom: 1px solid #e2e8f0;
    }
    .comparison-table tr:hover {
      background: #f8fafc;
    }
    .step-indicator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      border-radius: 50%;
      font-weight: bold;
      margin-right: 0.75rem;
    }
    .folder-tree {
      background: #0f172a;
      color: #e2e8f0;
      padding: 1.5rem;
      border-radius: 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      overflow-x: auto;
    }
    .folder-tree .folder { color: #60a5fa; }
    .folder-tree .file { color: #4ade80; }
    .folder-tree .comment { color: #64748b; }
    .folder-tree .special { color: #f59e0b; }
    .method-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      margin-right: 0.5rem;
    }
    .method-get { background: #dcfce7; color: #166534; }
    .method-post { background: #dbeafe; color: #1e40af; }
    .method-put { background: #fef3c7; color: #92400e; }
    .method-delete { background: #fee2e2; color: #991b1b; }
    .tab-container {
      margin: 2rem 0;
    }
    .tab-buttons {
      display: flex;
      gap: 0.5rem;
      margin-bottom: -2px;
    }
    .tab-button {
      padding: 0.75rem 1.5rem;
      background: #f1f5f9;
      border: 2px solid #e2e8f0;
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-weight: 500;
      color: #64748b;
      transition: all 0.2s;
    }
    .tab-button.active {
      background: white;
      border-color: #3b82f6;
      color: #1e40af;
    }
    .tab-content {
      background: white;
      border: 2px solid #3b82f6;
      border-radius: 0 8px 8px 8px;
      padding: 1.5rem;
    }
  </style>
</head>
<body>
  <nav class="nav">
    <a href="../index.html">Hjem</a>
    <a href="index.html">Start</a>
    <a href="frontend-backend.html"><strong>Frontend/Backend</strong></a>
    <a href="fullstack-arkitektur.html">Fullstack</a>
    <a href="database.html">Database</a>
  </nav>

  <div class="container">
    <h1>Frontend, Proxy & Backend Kommunikasjon</h1>

    <blockquote>
      <p>Komplett guide for hvordan frontend kommuniserer med backend i Next.js. ForstÃ¥ dataflyt, API-ruter, Server Actions, Proxy, og dynamisk ruting med <code>[id]</code>-mapper.</p>
    </blockquote>

    <div class="quick-nav">
      <strong>Hopp til:</strong><br>
      <a href="#oversikt">Oversikt & Dataflyt</a>
      <a href="#kommunikasjon">Kommunikasjonsmetoder</a>
      <a href="#server-vs-action">Server Component vs Action</a>
      <a href="#server-actions">Server Actions</a>
      <a href="#api-routes">API Routes</a>
      <a href="#proxy">Proxy (Rutebeskyttelse)</a>
      <a href="#route-groups">Route Groups</a>
      <a href="#dynamisk-ruting">Dynamisk Ruting [id]</a>
      <a href="#praktisk">Praktiske Eksempler</a>
    </div>

    <!-- ============================================ -->
    <!-- OVERSIKT -->
    <!-- ============================================ -->
    <h2 id="oversikt">Oversikt: Hvordan Data Flyter</h2>

    <p>I en moderne Next.js-applikasjon flyter data gjennom flere lag. Her er den komplette oversikten:</p>

    <div class="flow-diagram">
      <div style="text-align: center; padding: 1rem 0;">
        <div class="flow-box flow-frontend">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸ–¥ï¸</div>
          Frontend<br>
          <small style="opacity: 0.8;">(React/Next.js)</small>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box flow-proxy">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸ”’</div>
          Proxy<br>
          <small style="opacity: 0.8;">(Auth-sjekk)</small>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box flow-backend">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">âš™ï¸</div>
          Backend<br>
          <small style="opacity: 0.8;">(Server Actions/API)</small>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-box flow-database">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸ—„ï¸</div>
          Database<br>
          <small style="opacity: 0.8;">(Supabase/PostgreSQL)</small>
        </div>
      </div>
    </div>

    <div class="architecture-diagram">
      <h3>Detaljert Dataflyt</h3>
<pre style="margin:0; color: #e2e8f0; line-height: 1.8;">
<span style="color: #60a5fa;">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span style="color: #60a5fa;">â”‚</span>                           <span style="color: #f59e0b;">FRONTEND (Browser)</span>                        <span style="color: #60a5fa;">â”‚</span>
<span style="color: #60a5fa;">â”‚</span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    <span style="color: #60a5fa;">â”‚</span>
<span style="color: #60a5fa;">â”‚</span>  â”‚  <span style="color: #4ade80;">React Component</span> â”‚  â”‚  <span style="color: #4ade80;">Client State</span>   â”‚  â”‚  <span style="color: #4ade80;">Form Handler</span>   â”‚    <span style="color: #60a5fa;">â”‚</span>
<span style="color: #60a5fa;">â”‚</span>  â”‚  (page.tsx)     â”‚  â”‚  (useState)     â”‚  â”‚  (onSubmit)     â”‚    <span style="color: #60a5fa;">â”‚</span>
<span style="color: #60a5fa;">â”‚</span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    <span style="color: #60a5fa;">â”‚</span>
<span style="color: #60a5fa;">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
<span style="color: #f59e0b;">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span style="color: #f59e0b;">â”‚</span>                      <span style="color: #f59e0b;">PROXY (src/proxy.ts)</span>                            <span style="color: #f59e0b;">â”‚</span>
<span style="color: #f59e0b;">â”‚</span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  <span style="color: #f59e0b;">â”‚</span>
<span style="color: #f59e0b;">â”‚</span>  â”‚  <span style="color: #fbbf24;">â€¢ Sjekker JWT-token i cookies</span>                              â”‚  <span style="color: #f59e0b;">â”‚</span>
<span style="color: #f59e0b;">â”‚</span>  â”‚  <span style="color: #fbbf24;">â€¢ Validerer brukerrettigheter</span>                              â”‚  <span style="color: #f59e0b;">â”‚</span>
<span style="color: #f59e0b;">â”‚</span>  â”‚  <span style="color: #fbbf24;">â€¢ Redirecter til /login hvis uautorisert</span>                   â”‚  <span style="color: #f59e0b;">â”‚</span>
<span style="color: #f59e0b;">â”‚</span>  â”‚  <span style="color: #fbbf24;">â€¢ Legger til headers (CORS, security)</span>                      â”‚  <span style="color: #f59e0b;">â”‚</span>
<span style="color: #f59e0b;">â”‚</span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  <span style="color: #f59e0b;">â”‚</span>
<span style="color: #f59e0b;">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
                                  â”‚
                                  â–¼
<span style="color: #22c55e;">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span style="color: #22c55e;">â”‚</span>                         <span style="color: #22c55e;">BACKEND (Server)</span>                            <span style="color: #22c55e;">â”‚</span>
<span style="color: #22c55e;">â”‚</span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” <span style="color: #22c55e;">â”‚</span>
<span style="color: #22c55e;">â”‚</span>  â”‚  <span style="color: #4ade80;">Server Actions</span>  â”‚  â”‚  <span style="color: #4ade80;">API Routes</span>      â”‚  â”‚  <span style="color: #4ade80;">Server Comps</span>   â”‚ <span style="color: #22c55e;">â”‚</span>
<span style="color: #22c55e;">â”‚</span>  â”‚  (actions/*.ts)  â”‚  â”‚  (api/*/route.ts)â”‚  â”‚  (async fetch)  â”‚ <span style="color: #22c55e;">â”‚</span>
<span style="color: #22c55e;">â”‚</span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ <span style="color: #22c55e;">â”‚</span>
<span style="color: #22c55e;">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
            â”‚                      â”‚                      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
<span style="color: #8b5cf6;">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span style="color: #8b5cf6;">â”‚</span>                         <span style="color: #8b5cf6;">DATABASE</span>                                    <span style="color: #8b5cf6;">â”‚</span>
<span style="color: #8b5cf6;">â”‚</span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  <span style="color: #8b5cf6;">â”‚</span>
<span style="color: #8b5cf6;">â”‚</span>  â”‚  <span style="color: #c084fc;">Supabase / PostgreSQL / MongoDB</span>                            â”‚  <span style="color: #8b5cf6;">â”‚</span>
<span style="color: #8b5cf6;">â”‚</span>  â”‚  <span style="color: #c084fc;">â€¢ Tabeller: users, products, orders</span>                        â”‚  <span style="color: #8b5cf6;">â”‚</span>
<span style="color: #8b5cf6;">â”‚</span>  â”‚  <span style="color: #c084fc;">â€¢ RLS (Row Level Security)</span>                                 â”‚  <span style="color: #8b5cf6;">â”‚</span>
<span style="color: #8b5cf6;">â”‚</span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  <span style="color: #8b5cf6;">â”‚</span>
<span style="color: #8b5cf6;">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</pre>
    </div>

    <!-- ============================================ -->
    <!-- KOMMUNIKASJONSMETODER -->
    <!-- ============================================ -->
    <h2 id="kommunikasjon">3 MÃ¥ter Frontend Snakker med Backend</h2>

    <p>I Next.js App Router har du tre hovedmetoder for kommunikasjon:</p>

    <table class="comparison-table">
      <thead>
        <tr>
          <th>Metode</th>
          <th>NÃ¥r bruke</th>
          <th>Fordeler</th>
          <th>Ulemper</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Server Actions</strong></td>
          <td>Skjemaer, mutasjoner, CRUD</td>
          <td>Enklest, typesikker, ingen API-oppsett</td>
          <td>Kun POST, ikke for eksterne klienter</td>
        </tr>
        <tr>
          <td><strong>API Routes</strong></td>
          <td>Webhooks, eksterne API-er, fetch</td>
          <td>REST-standard, alle HTTP-metoder</td>
          <td>Mer boilerplate, manuell feilhÃ¥ndtering</td>
        </tr>
        <tr>
          <td><strong>Server Components</strong></td>
          <td>Datahenting ved sidelast</td>
          <td>Raskest, ingen loading state</td>
          <td>Kun lesing, ikke interaktiv</td>
        </tr>
      </tbody>
    </table>

    <div class="success-box">
      <h3 style="margin-top: 0;">Anbefaling</h3>
      <p style="margin: 0;"><strong>Server Actions</strong> for 90% av behovene dine (skjemaer, CRUD-operasjoner). <strong>API Routes</strong> kun nÃ¥r du trenger webhooks eller ekstern tilgang.</p>
    </div>

    <!-- ============================================ -->
    <!-- SERVER COMPONENT VS SERVER ACTION -->
    <!-- ============================================ -->
    <h2 id="server-vs-action">Server Component vs Server Action - Hva er forskjellen?</h2>

    <div class="warning-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fffbeb 100%); border: 2px solid #f59e0b;">
      <h3 style="margin-top: 0; color: #92400e;">Viktig konsept!</h3>
      <p style="margin: 0;">Mange forveksler disse to. Begge kjÃ¸rer pÃ¥ serveren, men pÃ¥ <strong>helt forskjellige tidspunkter</strong> og med <strong>ulike formÃ¥l</strong>.</p>
    </div>

    <h3>Visuell Forklaring</h3>

    <div class="architecture-diagram">
      <h3>Server Component: Data FÃ˜R siden vises</h3>
<pre style="margin:0; color: #e2e8f0; line-height: 1.8;">
<span style="color: #4ade80;">Bruker skriver: www.nettside.no/produkter</span>

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  <span style="color: #60a5fa;">STEG 1: SERVER</span>                                        â”‚
     â”‚                                                         â”‚
     â”‚  async function ProductsPage() {                        â”‚
     â”‚    <span style="color: #f59e0b;">// KjÃ¸rer HER pÃ¥ serveren</span>                           â”‚
     â”‚    const products = await supabase                      â”‚
     â”‚      .from("products")                                  â”‚
     â”‚      .select("*")                                       â”‚
     â”‚                                                         â”‚
     â”‚    <span style="color: #4ade80;">// products = [{id: 1, name: "Sko"}, ...]</span>            â”‚
     â”‚  }                                                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    <span style="color: #f59e0b;">Server sender FERDIG HTML</span>
                              â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  <span style="color: #60a5fa;">STEG 2: BROWSER</span>                                       â”‚
     â”‚                                                         â”‚
     â”‚  &lt;div&gt;                                                 â”‚
     â”‚    &lt;h3&gt;<span style="color: #4ade80;">Sko</span>&lt;/h3&gt;                                        â”‚
     â”‚    &lt;p&gt;<span style="color: #4ade80;">499 kr</span>&lt;/p&gt;                                       â”‚
     â”‚  &lt;/div&gt;                                                â”‚
     â”‚                                                         â”‚
     â”‚  <span style="color: #22c55e;">âœ“ Data er ALLEREDE i HTML - ingen loading!</span>            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
    </div>

    <div class="architecture-diagram" style="background: linear-gradient(135deg, #1e3a5f 0%, #2d4a6f 100%);">
      <h3>Server Action: Data NÃ…R bruker gjÃ¸r noe</h3>
<pre style="margin:0; color: #e2e8f0; line-height: 1.8;">
<span style="color: #4ade80;">Bruker klikker "Legg til produkt"-knappen</span>

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  <span style="color: #60a5fa;">STEG 1: BROWSER (Client Component)</span>                    â”‚
     â”‚                                                         â”‚
     â”‚  async function handleSubmit(formData) {                â”‚
     â”‚    <span style="color: #f59e0b;">// Kaller server action</span>                              â”‚
     â”‚    const result = await createProduct(formData)         â”‚
     â”‚                         <span style="color: #f59e0b;">â†‘</span>                              â”‚
     â”‚                    <span style="color: #f59e0b;">Denne gÃ¥r til serveren</span>               â”‚
     â”‚  }                                                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    <span style="color: #f59e0b;">Next.js sender request til server</span>
                              â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  <span style="color: #60a5fa;">STEG 2: SERVER (Server Action)</span>                        â”‚
     â”‚                                                         â”‚
     â”‚  "use server"                                           â”‚
     â”‚  async function createProduct(formData) {               â”‚
     â”‚    await supabase.from("products").insert({...})        â”‚
     â”‚    <span style="color: #4ade80;">return { success: true, message: "Opprettet!" }</span>       â”‚
     â”‚           <span style="color: #f59e0b;">â†‘</span>                                             â”‚
     â”‚      <span style="color: #f59e0b;">Denne sendes TILBAKE til frontend</span>                   â”‚
     â”‚  }                                                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    <span style="color: #f59e0b;">Return-verdien sendes til browser</span>
                              â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  <span style="color: #60a5fa;">STEG 3: BROWSER (mottar svar)</span>                         â”‚
     â”‚                                                         â”‚
     â”‚  const result = await createProduct(formData)           â”‚
     â”‚  <span style="color: #4ade80;">// result = { success: true, message: "Opprettet!" }</span>   â”‚
     â”‚                                                         â”‚
     â”‚  console.log(result.message) <span style="color: #4ade80;">// "Opprettet!"</span>           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
    </div>

    <h3>Sammenligning: NÃ¥r bruke hva?</h3>

    <table class="comparison-table">
      <thead>
        <tr>
          <th style="width: 20%;">Aspekt</th>
          <th style="width: 40%;">Server Component</th>
          <th style="width: 40%;">Server Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>NÃ¥r kjÃ¸rer den?</strong></td>
          <td>Ved sidelasting (fÃ¸r HTML sendes)</td>
          <td>NÃ¥r bruker klikker/submitter (etter sidelasting)</td>
        </tr>
        <tr>
          <td><strong>Hvordan fÃ¥r frontend data?</strong></td>
          <td>Data er allerede i HTML fra server</td>
          <td>Via <code>return</code>-verdien fra funksjonen</td>
        </tr>
        <tr>
          <td><strong>Typisk bruk</strong></td>
          <td>Vise lister, produkter, artikler</td>
          <td>Skjemaer, "Legg til", "Slett", "Oppdater"</td>
        </tr>
        <tr>
          <td><strong>Trenger loading state?</strong></td>
          <td>Nei - data er klar med Ã©n gang</td>
          <td>Ja - bruker venter pÃ¥ respons</td>
        </tr>
        <tr>
          <td><strong>Synlig i nettleseren?</strong></td>
          <td>Nei - kun HTML sendes</td>
          <td>Nei - kun return-verdien sendes</td>
        </tr>
      </tbody>
    </table>

    <h3>Komplett Kodeeksempel</h3>

    <div class="file-path">Server Component: Henter data ved sidelast</div>
    <pre><code>// src/app/produkter/page.tsx
// INGEN "use client" = Server Component

import supabase from "@/config/supabase-config"

export default async function ProductsPage() {
  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚  Dette kjÃ¸rer pÃ¥ SERVEREN fÃ¸r HTML sendes      â”‚
  // â”‚  Bruker ser ALDRI denne koden i nettleseren    â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  const { data: products } = await supabase
    .from("products")
    .select("*")

  // HTML sendes til bruker MED data ferdig utfylt
  return (
    &lt;div&gt;
      &lt;h1&gt;Produkter&lt;/h1&gt;
      {products?.map((product) => (
        &lt;div key={product.id}&gt;
          &lt;h3&gt;{product.name}&lt;/h3&gt;
          &lt;p&gt;{product.price} kr&lt;/p&gt;
        &lt;/div&gt;
      ))}
    &lt;/div&gt;
  )
}

// Bruker Ã¥pner /produkter:
// 1. Server kjÃ¸rer funksjonen
// 2. Server henter data fra database
// 3. Server sender ferdig HTML: "&lt;div&gt;&lt;h3&gt;Sko&lt;/h3&gt;&lt;p&gt;499 kr&lt;/p&gt;&lt;/div&gt;"
// 4. Bruker ser produktene UMIDDELBART (ingen loading)</code></pre>

    <div class="file-path">Server Action: KjÃ¸rer nÃ¥r bruker klikker</div>
    <pre><code>// src/actions/products.ts
"use server"  // â† Markerer at dette er en Server Action

import supabase from "@/config/supabase-config"

export async function createProduct(formData: FormData) {
  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚  Dette kjÃ¸rer pÃ¥ SERVEREN nÃ¥r bruker submitter â”‚
  // â”‚  formData kommer fra frontend skjemaet         â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  const name = formData.get("name") as string
  const price = parseFloat(formData.get("price") as string)

  const { error } = await supabase
    .from("products")
    .insert({ name, price })

  if (error) {
    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚  return-verdien sendes TILBAKE til frontend    â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    return { success: false, message: "Kunne ikke opprette" }
  }

  return { success: true, message: "Produkt opprettet!" }
}</code></pre>

    <div class="file-path">Client Component: Bruker Server Action</div>
    <pre><code>// src/components/CreateProductForm.tsx
"use client"  // â† MÃ… vÃ¦re client for interaktivitet

import { useState } from "react"
import { createProduct } from "@/actions/products"

export default function CreateProductForm() {
  const [message, setMessage] = useState("")
  const [loading, setLoading] = useState(false)

  async function handleSubmit(formData: FormData) {
    setLoading(true)

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚  Kall Server Action - den kjÃ¸rer pÃ¥ serveren   â”‚
    // â”‚  MEN return-verdien kommer TILBAKE hit         â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    const result = await createProduct(formData)

    // result = { success: true, message: "Produkt opprettet!" }
    setMessage(result.message)
    setLoading(false)
  }

  return (
    &lt;form action={handleSubmit}&gt;
      &lt;input name="name" placeholder="Produktnavn" /&gt;
      &lt;input name="price" type="number" placeholder="Pris" /&gt;

      &lt;button type="submit" disabled={loading}&gt;
        {loading ? "Lagrer..." : "Opprett"}
      &lt;/button&gt;

      {/* Viser meldingen som kom fra server */}
      {message && &lt;p&gt;{message}&lt;/p&gt;}
    &lt;/form&gt;
  )
}</code></pre>

    <div class="success-box" style="background: linear-gradient(135deg, #dcfce7 0%, #f0fdf4 100%); border: 2px solid #22c55e;">
      <h3 style="margin-top: 0; color: #166534;">NÃ¸kkelpunkt: Hvordan data kommer tilbake</h3>
      <p style="margin: 0.5rem 0;">
        <strong>Server Action er som en vanlig <code>await</code>-funksjon!</strong><br>
        Selv om funksjonen kjÃ¸rer pÃ¥ serveren, fÃ¥r du return-verdien akkurat som om den kjÃ¸rte lokalt.
      </p>
      <pre style="background: white; padding: 1rem; border-radius: 8px; margin-top: 1rem;"><code>// Dette er MAGIEN i Server Actions:

// Gammel mÃ¥te (fetch til API):
const response = await fetch("/api/products", {
  method: "POST",
  body: formData
})
const result = await response.json()

// Ny mÃ¥te (Server Action) - MYE enklere:
const result = await createProduct(formData)

// Begge gir SAMME result!
// Next.js hÃ¥ndterer HTTP-kallet automatisk i bakgrunnen</code></pre>
    </div>

    <!-- ============================================ -->
    <!-- SERVER ACTIONS -->
    <!-- ============================================ -->
    <h2 id="server-actions">Server Actions - Den Moderne MÃ¥ten</h2>

    <p>Server Actions lar deg kalle server-funksjoner direkte fra frontend uten Ã¥ sette opp API-endepunkter:</p>

    <div class="concept-card">
      <h4>
        <span class="concept-icon" style="background: linear-gradient(135deg, #dcfce7, #bbf7d0);">âš¡</span>
        Hvordan Server Actions Fungerer
      </h4>
      <ol style="margin: 1rem 0 0 0; padding-left: 1.25rem; color: #475569;">
        <li>Marker funksjonen med <code>"use server"</code></li>
        <li>Importer og kall direkte fra Client Component</li>
        <li>Next.js hÃ¥ndterer serialisering og HTTP automatisk</li>
        <li>Returnerer data tilbake til frontend</li>
      </ol>
    </div>

    <h3><span class="step-indicator">1</span>Opprette en Server Action</h3>

    <div class="file-path">src/actions/products.ts</div>
    <pre><code>"use server"

import supabase from "@/config/supabase-config"
import { revalidatePath } from "next/cache"

// TypeScript interface for typesikkerhet
interface Product {
  id: string
  name: string
  price: number
  description: string
}

// ============================================
// HENT ALLE PRODUKTER
// ============================================
export async function getProducts() {
  try {
    const { data, error } = await supabase
      .from("products")
      .select("*")
      .order("created_at", { ascending: false })

    if (error) throw error

    return { success: true, data }
  } catch (error) {
    console.error("Error fetching products:", error)
    return { success: false, data: [], message: "Kunne ikke hente produkter" }
  }
}

// ============================================
// HENT ETT PRODUKT MED ID
// ============================================
export async function getProductById(id: string) {
  try {
    const { data, error } = await supabase
      .from("products")
      .select("*")
      .eq("id", id)
      .single()

    if (error) throw error

    return { success: true, data }
  } catch (error) {
    return { success: false, data: null, message: "Produkt ikke funnet" }
  }
}

// ============================================
// OPPRETT NYTT PRODUKT
// ============================================
export async function createProduct(formData: FormData) {
  try {
    const name = formData.get("name") as string
    const price = parseFloat(formData.get("price") as string)
    const description = formData.get("description") as string

    // Validering
    if (!name || !price) {
      return { success: false, message: "Navn og pris er pÃ¥krevd" }
    }

    const { data, error } = await supabase
      .from("products")
      .insert({ name, price, description })
      .select()
      .single()

    if (error) throw error

    // Revaliderer cache slik at listen oppdateres
    revalidatePath("/produkter")

    return { success: true, data, message: "Produkt opprettet!" }
  } catch (error) {
    console.error("Error creating product:", error)
    return { success: false, message: "Kunne ikke opprette produkt" }
  }
}

// ============================================
// OPPDATER PRODUKT
// ============================================
export async function updateProduct(id: string, formData: FormData) {
  try {
    const name = formData.get("name") as string
    const price = parseFloat(formData.get("price") as string)
    const description = formData.get("description") as string

    const { data, error } = await supabase
      .from("products")
      .update({ name, price, description })
      .eq("id", id)
      .select()
      .single()

    if (error) throw error

    revalidatePath("/produkter")
    revalidatePath(`/produkter/${id}`)

    return { success: true, data, message: "Produkt oppdatert!" }
  } catch (error) {
    return { success: false, message: "Kunne ikke oppdatere produkt" }
  }
}

// ============================================
// SLETT PRODUKT
// ============================================
export async function deleteProduct(id: string) {
  try {
    const { error } = await supabase
      .from("products")
      .delete()
      .eq("id", id)

    if (error) throw error

    revalidatePath("/produkter")

    return { success: true, message: "Produkt slettet!" }
  } catch (error) {
    return { success: false, message: "Kunne ikke slette produkt" }
  }
}</code></pre>

    <h3><span class="step-indicator">2</span>Bruke Server Action i Frontend</h3>

    <div class="file-path">src/app/produkter/page.tsx (Server Component)</div>
    <pre><code>// Server Component - henter data direkte
import { getProducts } from "@/actions/products"
import ProductList from "@/components/ProductList"
import CreateProductForm from "@/components/CreateProductForm"

export default async function ProductsPage() {
  // Hent data pÃ¥ serveren (ingen loading state trengs!)
  const { data: products } = await getProducts()

  return (
    &lt;div className="max-w-4xl mx-auto p-8"&gt;
      &lt;h1 className="text-3xl font-bold mb-8"&gt;Produkter&lt;/h1&gt;

      {/* Skjema for Ã¥ opprette nytt produkt */}
      &lt;CreateProductForm /&gt;

      {/* Liste over produkter */}
      &lt;ProductList products={products} /&gt;
    &lt;/div&gt;
  )
}</code></pre>

    <div class="file-path">src/components/CreateProductForm.tsx (Client Component)</div>
    <pre><code>"use client"

import { useState } from "react"
import { createProduct } from "@/actions/products"
import { useRouter } from "next/navigation"

export default function CreateProductForm() {
  const [isPending, setIsPending] = useState(false)
  const [message, setMessage] = useState("")
  const router = useRouter()

  async function handleSubmit(formData: FormData) {
    setIsPending(true)
    setMessage("")

    // Kall Server Action direkte!
    const result = await createProduct(formData)

    setIsPending(false)
    setMessage(result.message || "")

    if (result.success) {
      // TÃ¸m skjema eller redirect
      router.refresh() // Oppdaterer Server Component
    }
  }

  return (
    &lt;form action={handleSubmit} className="bg-white p-6 rounded-lg shadow mb-8"&gt;
      &lt;h2 className="text-xl font-bold mb-4"&gt;Nytt produkt&lt;/h2&gt;

      &lt;div className="space-y-4"&gt;
        &lt;input
          type="text"
          name="name"
          placeholder="Produktnavn"
          required
          className="w-full p-3 border rounded-lg"
        /&gt;

        &lt;input
          type="number"
          name="price"
          placeholder="Pris"
          step="0.01"
          required
          className="w-full p-3 border rounded-lg"
        /&gt;

        &lt;textarea
          name="description"
          placeholder="Beskrivelse"
          className="w-full p-3 border rounded-lg"
          rows={3}
        /&gt;

        &lt;button
          type="submit"
          disabled={isPending}
          className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50"
        &gt;
          {isPending ? "Oppretter..." : "Opprett produkt"}
        &lt;/button&gt;
      &lt;/div&gt;

      {message && (
        &lt;p className={`mt-4 p-3 rounded ${
          message.includes("opprettet") ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"
        }`}&gt;
          {message}
        &lt;/p&gt;
      )}
    &lt;/form&gt;
  )
}</code></pre>

    <!-- ============================================ -->
    <!-- API ROUTES -->
    <!-- ============================================ -->
    <h2 id="api-routes">API Routes - REST-endepunkter</h2>

    <p>Bruk API Routes nÃ¥r du trenger:</p>
    <ul>
      <li>Webhooks fra eksterne tjenester (Stripe, GitHub, etc.)</li>
      <li>REST API for mobilapper eller tredjeparter</li>
      <li>Spesifikke HTTP-metoder (GET, PUT, DELETE)</li>
    </ul>

    <div class="file-path">src/app/api/products/route.ts</div>
    <pre><code>import { NextRequest, NextResponse } from "next/server"
import supabase from "@/config/supabase-config"

// ============================================
// GET - Hent alle produkter
// ============================================
export async function GET(request: NextRequest) {
  try {
    // Hent query parameters
    const { searchParams } = new URL(request.url)
    const limit = parseInt(searchParams.get("limit") || "10")
    const offset = parseInt(searchParams.get("offset") || "0")

    const { data, error, count } = await supabase
      .from("products")
      .select("*", { count: "exact" })
      .range(offset, offset + limit - 1)
      .order("created_at", { ascending: false })

    if (error) throw error

    return NextResponse.json({
      success: true,
      data,
      pagination: {
        total: count,
        limit,
        offset
      }
    })
  } catch (error) {
    return NextResponse.json(
      { success: false, message: "Kunne ikke hente produkter" },
      { status: 500 }
    )
  }
}

// ============================================
// POST - Opprett nytt produkt
// ============================================
export async function POST(request: NextRequest) {
  try {
    const body = await request.json()

    // Validering
    if (!body.name || !body.price) {
      return NextResponse.json(
        { success: false, message: "Navn og pris er pÃ¥krevd" },
        { status: 400 }
      )
    }

    const { data, error } = await supabase
      .from("products")
      .insert({
        name: body.name,
        price: body.price,
        description: body.description
      })
      .select()
      .single()

    if (error) throw error

    return NextResponse.json(
      { success: true, data },
      { status: 201 }
    )
  } catch (error) {
    return NextResponse.json(
      { success: false, message: "Kunne ikke opprette produkt" },
      { status: 500 }
    )
  }
}</code></pre>

    <div class="file-path">src/app/api/products/[id]/route.ts</div>
    <pre><code>import { NextRequest, NextResponse } from "next/server"
import supabase from "@/config/supabase-config"

interface Params {
  params: { id: string }
}

// ============================================
// GET - Hent ett produkt
// ============================================
export async function GET(request: NextRequest, { params }: Params) {
  try {
    const { id } = await params

    const { data, error } = await supabase
      .from("products")
      .select("*")
      .eq("id", id)
      .single()

    if (error || !data) {
      return NextResponse.json(
        { success: false, message: "Produkt ikke funnet" },
        { status: 404 }
      )
    }

    return NextResponse.json({ success: true, data })
  } catch (error) {
    return NextResponse.json(
      { success: false, message: "Serverfeil" },
      { status: 500 }
    )
  }
}

// ============================================
// PUT - Oppdater produkt
// ============================================
export async function PUT(request: NextRequest, { params }: Params) {
  try {
    const { id } = await params
    const body = await request.json()

    const { data, error } = await supabase
      .from("products")
      .update({
        name: body.name,
        price: body.price,
        description: body.description
      })
      .eq("id", id)
      .select()
      .single()

    if (error) throw error

    return NextResponse.json({ success: true, data })
  } catch (error) {
    return NextResponse.json(
      { success: false, message: "Kunne ikke oppdatere" },
      { status: 500 }
    )
  }
}

// ============================================
// DELETE - Slett produkt
// ============================================
export async function DELETE(request: NextRequest, { params }: Params) {
  try {
    const { id } = await params

    const { error } = await supabase
      .from("products")
      .delete()
      .eq("id", id)

    if (error) throw error

    return NextResponse.json(
      { success: true, message: "Produkt slettet" }
    )
  } catch (error) {
    return NextResponse.json(
      { success: false, message: "Kunne ikke slette" },
      { status: 500 }
    )
  }
}</code></pre>

    <h3>Kalle API fra Frontend</h3>

    <div class="file-path">src/lib/api.ts</div>
    <pre><code>// Gjenbrukbar API-klient

const API_BASE = "/api"

export async function fetchProducts(limit = 10, offset = 0) {
  const res = await fetch(`${API_BASE}/products?limit=${limit}&offset=${offset}`)
  if (!res.ok) throw new Error("Kunne ikke hente produkter")
  return res.json()
}

export async function fetchProductById(id: string) {
  const res = await fetch(`${API_BASE}/products/${id}`)
  if (!res.ok) throw new Error("Produkt ikke funnet")
  return res.json()
}

export async function createProduct(data: {
  name: string
  price: number
  description?: string
}) {
  const res = await fetch(`${API_BASE}/products`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  if (!res.ok) throw new Error("Kunne ikke opprette produkt")
  return res.json()
}

export async function updateProduct(id: string, data: {
  name?: string
  price?: number
  description?: string
}) {
  const res = await fetch(`${API_BASE}/products/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  if (!res.ok) throw new Error("Kunne ikke oppdatere produkt")
  return res.json()
}

export async function deleteProduct(id: string) {
  const res = await fetch(`${API_BASE}/products/${id}`, {
    method: "DELETE"
  })
  if (!res.ok) throw new Error("Kunne ikke slette produkt")
  return res.json()
}</code></pre>

    <!-- ============================================ -->
    <!-- PROXY -->
    <!-- ============================================ -->
    <h2 id="proxy">Proxy - Rutebeskyttelse (Next.js 16)</h2>

    <div class="warning-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fffbeb 100%); border: 2px solid #f59e0b;">
      <h3 style="margin-top: 0; color: #92400e;">Viktig Ã¥ forstÃ¥!</h3>
      <p style="margin: 0;">Proxy og Server Actions har <strong>helt forskjellige roller</strong>. De jobber SAMMEN, ikke istedenfor hverandre.</p>
    </div>

    <h3>Proxy vs Server Actions - Hva er forskjellen?</h3>

    <div class="architecture-diagram">
      <h3>Hvordan de jobber sammen</h3>
<pre style="margin:0; color: #e2e8f0; line-height: 1.8;">
<span style="color: #4ade80;">Bruker klikker "Slett produkt"</span>

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  <span style="color: #60a5fa;">STEG 1: PROXY (Vakt/DÃ¸rvakt)</span>                          â”‚
     â”‚                                                         â”‚
     â”‚  "Hvem er du? Har du lov til Ã¥ vÃ¦re her?"               â”‚
     â”‚                                                         â”‚
     â”‚  âœ“ Sjekker JWT token i cookie                          â”‚
     â”‚  âœ“ Validerer at bruker er innlogget                    â”‚
     â”‚  âœ“ Sjekker rolle (admin/bruker)                        â”‚
     â”‚  âœ“ STOPPER request hvis ikke autorisert                â”‚
     â”‚                                                         â”‚
     â”‚  <span style="color: #f59e0b;">Proxy KAN IKKE slette produktet selv!</span>                  â”‚
     â”‚  <span style="color: #f59e0b;">Den bare sjekker om du har tilgang.</span>                    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    <span style="color: #22c55e;">âœ“ Autorisert - fortsett</span>
                              â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  <span style="color: #60a5fa;">STEG 2: SERVER ACTION (Arbeider)</span>                      â”‚
     â”‚                                                         â”‚
     â”‚  "OK, du har tilgang. La meg gjÃ¸re jobben."             â”‚
     â”‚                                                         â”‚
     â”‚  async function deleteProduct(id) {                     â”‚
     â”‚    await supabase.from("products").delete().eq("id",id) â”‚
     â”‚    return { success: true }                             â”‚
     â”‚  }                                                      â”‚
     â”‚                                                         â”‚
     â”‚  <span style="color: #4ade80;">Server Action GJÃ˜R selve jobben (CRUD)</span>                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
    </div>

    <table class="comparison-table">
      <thead>
        <tr>
          <th style="width: 20%;">Aspekt</th>
          <th style="width: 40%;">Proxy (Next.js 16)</th>
          <th style="width: 40%;">Server Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Rolle</strong></td>
          <td>DÃ¸rvakt - sjekker tilgang</td>
          <td>Arbeider - utfÃ¸rer oppgaver</td>
        </tr>
        <tr>
          <td><strong>NÃ¥r kjÃ¸rer</strong></td>
          <td>FÃ˜R request nÃ¥r siden/action</td>
          <td>NÃ…R request er godkjent</td>
        </tr>
        <tr>
          <td><strong>Hva gjÃ¸r den</strong></td>
          <td>Validerer token, sjekker roller, redirecter</td>
          <td>CRUD: Create, Read, Update, Delete</td>
        </tr>
        <tr>
          <td><strong>Kan stoppe request</strong></td>
          <td><strong style="color: #22c55e;">JA</strong> - redirect til /login</td>
          <td>NEI - den utfÃ¸rer bare jobben</td>
        </tr>
        <tr>
          <td><strong>Har tilgang til database</strong></td>
          <td>Nei (kun enkel validering)</td>
          <td><strong style="color: #22c55e;">JA</strong> - full database-tilgang</td>
        </tr>
        <tr>
          <td><strong>Returnerer data</strong></td>
          <td>Nei - bare videresender eller stopper</td>
          <td><strong style="color: #22c55e;">JA</strong> - returnerer data til frontend</td>
        </tr>
      </tbody>
    </table>

    <div class="success-box" style="background: linear-gradient(135deg, #dcfce7 0%, #f0fdf4 100%); border: 2px solid #22c55e;">
      <h3 style="margin-top: 0; color: #166534;">Analogi: Restaurant</h3>
      <p style="margin: 0;">
        <strong>Proxy = DÃ¸rvakt</strong>: Sjekker reservasjon, ID, kleskode<br>
        <strong>Server Action = Kelner/Kokk</strong>: Tar imot bestilling, lager mat, serverer
      </p>
      <p style="margin-top: 0.5rem; margin-bottom: 0;">
        DÃ¸rvakten lager ikke maten. Kokken sjekker ikke ID. De har ulike jobber!
      </p>
    </div>

    <h3>Hvorfor trenger vi begge?</h3>

    <div class="architecture-diagram" style="background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);">
      <h3 style="color: #fca5a5;">FEIL: Kun Server Action (ingen proxy)</h3>
<pre style="margin:0; color: #fecaca; line-height: 1.6;">
// Hva skjer hvis vi BARE bruker Server Action?

async function deleteProduct(id: string) {
  // Ingen sjekk om bruker er innlogget!
  // Ingen sjekk om bruker har lov til Ã¥ slette!

  await supabase.from("products").delete().eq("id", id)
  return { success: true }
}

<span style="color: #ef4444;">PROBLEM: Hvem som helst kan slette produkter!</span>
En angriper kan kalle denne funksjonen direkte.
</pre>
    </div>

    <div class="architecture-diagram" style="background: linear-gradient(135deg, #14532d 0%, #166534 100%);">
      <h3 style="color: #86efac;">RIKTIG: Proxy + Server Action</h3>
<pre style="margin:0; color: #dcfce7; line-height: 1.6;">
// Proxy sjekker FÃ˜RST (src/proxy.ts i Next.js 16)
export async function proxy(request: NextRequest) {
  const token = request.cookies.get("token")
  if (!token) {
    return NextResponse.redirect("/login")  // <span style="color: #4ade80;">STOPP!</span>
  }

  const { payload } = await jwtVerify(token, secret)
  if (payload.role !== "admin") {
    return NextResponse.redirect("/dashboard")  // <span style="color: #4ade80;">STOPP!</span>
  }

  return NextResponse.next()  // <span style="color: #4ade80;">OK, fortsett</span>
}

// Server Action utfÃ¸rer ETTER godkjenning
async function deleteProduct(id: string) {
  // Proxy har allerede sjekket at bruker er admin
  await supabase.from("products").delete().eq("id", id)
  return { success: true }
}

<span style="color: #4ade80;">TRYGT: Kun autoriserte brukere kan slette!</span>
</pre>
    </div>

    <h3>Komplett sikkerhetslag</h3>

    <p>For maksimal sikkerhet bÃ¸r du ha <strong>flere lag</strong>:</p>

    <div class="architecture-diagram">
      <h3>3 Lag med Sikkerhet</h3>
<pre style="margin:0; color: #e2e8f0; line-height: 1.8;">
<span style="color: #f59e0b;">LAG 1: PROXY</span> (src/proxy.ts - Next.js 16)
â”œâ”€â”€ KjÃ¸rer pÃ¥ ALLE requests
â”œâ”€â”€ Sjekker JWT token
â”œâ”€â”€ Validerer roller
â””â”€â”€ Redirecter uautoriserte

         â†“ (kun autoriserte kommer forbi)

<span style="color: #60a5fa;">LAG 2: SERVER ACTION</span> (src/actions/*.ts)
â”œâ”€â”€ Dobbeltsjekk av userId (ekstra sikkerhet)
â”œâ”€â”€ Validerer input data
â”œâ”€â”€ UtfÃ¸rer database-operasjoner
â””â”€â”€ Returnerer resultat

         â†“ (kun gyldige operasjoner)

<span style="color: #8b5cf6;">LAG 3: DATABASE RLS</span> (Supabase Row Level Security)
â”œâ”€â”€ Siste forsvarslinje
â”œâ”€â”€ Brukere kan KUN se/endre egne data
â””â”€â”€ Selv om alt annet feiler, stopper RLS uautorisert tilgang
</pre>
    </div>

    <p>Proxy kjÃ¸rer <strong>fÃ¸r</strong> hver request og kan:</p>
    <ul>
      <li>Sjekke om brukeren er innlogget</li>
      <li>Validere roller (admin, bruker)</li>
      <li>Redirecte til login-side</li>
      <li>Legge til headers</li>
    </ul>

    <div class="warning-box">
      <strong>Viktig:</strong> I Next.js 16 heter filen <code>proxy.ts</code> og ligger i roten av <code>src/</code>-mappen.
    </div>

    <div class="file-path">src/proxy.ts</div>
    <pre><code>import { NextRequest, NextResponse } from "next/server"
import { jwtVerify } from "jose"

// Ruter som IKKE krever autentisering
const publicRoutes = [
  "/",
  "/om-oss",
  "/tjenester",
  "/kontakt",
  "/login",
  "/register",
  "/glemt-passord",
]

// Ruter som krever ADMIN-rolle
const adminRoutes = ["/admin"]

// Ruter som krever innlogging
const protectedRoutes = ["/dashboard", "/profil", "/innstillinger"]

export async function proxy(request: NextRequest) {
  const { pathname } = request.nextUrl

  // ============================================
  // 1. Sjekk om ruten er offentlig
  // ============================================
  const isPublicRoute = publicRoutes.some(route =>
    pathname === route || pathname.startsWith(`${route}/`)
  )

  if (isPublicRoute) {
    return NextResponse.next()
  }

  // ============================================
  // 2. Hent og valider token
  // ============================================
  const token = request.cookies.get("token")?.value

  if (!token) {
    // Ingen token - redirect til login
    const loginUrl = new URL("/login", request.url)
    loginUrl.searchParams.set("redirect", pathname)
    return NextResponse.redirect(loginUrl)
  }

  try {
    // Verifiser JWT
    const secret = new TextEncoder().encode(process.env.JWT_SECRET!)
    const { payload } = await jwtVerify(token, secret)

    // ============================================
    // 3. Sjekk admin-tilgang
    // ============================================
    const isAdminRoute = adminRoutes.some(route =>
      pathname.startsWith(route)
    )

    if (isAdminRoute && payload.role !== "admin") {
      // Ikke admin - redirect til dashboard
      return NextResponse.redirect(new URL("/dashboard", request.url))
    }

    // ============================================
    // 4. Alt OK - fortsett
    // ============================================
    // Legg til brukerinfo i headers (tilgjengelig i Server Components)
    const response = NextResponse.next()
    response.headers.set("x-user-id", payload.userId as string)
    response.headers.set("x-user-role", payload.role as string)

    return response

  } catch (error) {
    // Ugyldig token - redirect til login
    console.error("Token verification failed:", error)
    const response = NextResponse.redirect(new URL("/login", request.url))
    response.cookies.delete("token")
    return response
  }
}

// ============================================
// Konfigurasjon: Hvilke ruter skal proxy kjÃ¸re pÃ¥
// ============================================
export const config = {
  matcher: [
    /*
     * Match alle ruter unntatt:
     * - _next/static (statiske filer)
     * - _next/image (bilde-optimalisering)
     * - favicon.ico
     * - public-mappen
     */
    "/((?!_next/static|_next/image|favicon.ico|.*\\..*|api/webhook).*)",
  ],
}</code></pre>

    <div class="success-box">
      <h3 style="margin-top: 0;">Hvordan Proxy Fungerer</h3>
<pre style="margin: 1rem 0 0 0; background: #f1f5f9; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.9rem;">
Bruker besÃ¸ker /admin/dashboard
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PROXY               â”‚
â”‚  1. Er /admin offentlig? NEIâ”‚
â”‚  2. Har bruker token? JA    â”‚
â”‚  3. Er token gyldig? JA     â”‚
â”‚  4. Er bruker admin? JA     â”‚
â”‚  â†’ Fortsett til siden       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   Admin Dashboard vises
</pre>
    </div>

    <!-- ============================================ -->
    <!-- ROUTE GROUPS -->
    <!-- ============================================ -->
    <h2 id="route-groups">Route Groups: (public), (protected), (admin)</h2>

    <p>Route Groups lar deg organisere ruter med <strong>delte layouts</strong> uten Ã¥ pÃ¥virke URL-strukturen:</p>

    <div class="folder-tree">
<span class="folder">src/app/</span>
â”œâ”€â”€ <span class="special">(public)/</span>                 <span class="comment"># Parentes = ikke del av URL</span>
â”‚   â”œâ”€â”€ layout.tsx            <span class="comment"># Layout med header/footer</span>
â”‚   â”œâ”€â”€ <span class="file">page.tsx</span>              <span class="comment"># URL: / (forside)</span>
â”‚   â”œâ”€â”€ <span class="folder">om-oss/</span>
â”‚   â”‚   â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /om-oss</span>
â”‚   â”œâ”€â”€ <span class="folder">tjenester/</span>
â”‚   â”‚   â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /tjenester</span>
â”‚   â””â”€â”€ <span class="folder">kontakt/</span>
â”‚       â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /kontakt</span>
â”‚
â”œâ”€â”€ <span class="special">(auth)/</span>                   <span class="comment"># Auth-sider (minimal layout)</span>
â”‚   â”œâ”€â”€ layout.tsx            <span class="comment"># Enkel layout uten header</span>
â”‚   â”œâ”€â”€ <span class="folder">login/</span>
â”‚   â”‚   â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /login</span>
â”‚   â”œâ”€â”€ <span class="folder">register/</span>
â”‚   â”‚   â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /register</span>
â”‚   â””â”€â”€ <span class="folder">glemt-passord/</span>
â”‚       â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /glemt-passord</span>
â”‚
â”œâ”€â”€ <span class="special">(protected)/</span>              <span class="comment"># Krever innlogging</span>
â”‚   â”œâ”€â”€ layout.tsx            <span class="comment"># Sjekker auth, viser bruker-nav</span>
â”‚   â”œâ”€â”€ <span class="folder">dashboard/</span>
â”‚   â”‚   â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /dashboard</span>
â”‚   â”œâ”€â”€ <span class="folder">profil/</span>
â”‚   â”‚   â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /profil</span>
â”‚   â””â”€â”€ <span class="folder">innstillinger/</span>
â”‚       â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /innstillinger</span>
â”‚
â””â”€â”€ <span class="special">(admin)/</span>                  <span class="comment"># Krever admin-rolle</span>
    â”œâ”€â”€ layout.tsx            <span class="comment"># Admin sidebar</span>
    â””â”€â”€ <span class="folder">admin/</span>
        â”œâ”€â”€ <span class="file">page.tsx</span>          <span class="comment"># URL: /admin</span>
        â”œâ”€â”€ <span class="folder">brukere/</span>
        â”‚   â””â”€â”€ <span class="file">page.tsx</span>      <span class="comment"># URL: /admin/brukere</span>
        â””â”€â”€ <span class="folder">innhold/</span>
            â””â”€â”€ <span class="file">page.tsx</span>      <span class="comment"># URL: /admin/innhold</span>
    </div>

    <h3>Eksempel: Protected Layout</h3>

    <div class="file-path">src/app/(protected)/layout.tsx</div>
    <pre><code>import { redirect } from "next/navigation"
import { getLoggedInUser } from "@/actions/auth"
import UserNav from "@/components/layout/UserNav"

export default async function ProtectedLayout({
  children
}: {
  children: React.ReactNode
}) {
  // Sjekk om bruker er innlogget
  const { success, user } = await getLoggedInUser()

  if (!success || !user) {
    redirect("/login")
  }

  return (
    &lt;div className="min-h-screen bg-gray-50"&gt;
      {/* Bruker-navigasjon med profilmeny */}
      &lt;UserNav user={user} /&gt;

      {/* Hovedinnhold */}
      &lt;main className="max-w-7xl mx-auto px-4 py-8"&gt;
        {children}
      &lt;/main&gt;
    &lt;/div&gt;
  )
}</code></pre>

    <h3>Eksempel: Admin Layout</h3>

    <div class="file-path">src/app/(admin)/layout.tsx</div>
    <pre><code>import { redirect } from "next/navigation"
import { getLoggedInUser } from "@/actions/auth"
import AdminSidebar from "@/components/layout/AdminSidebar"

export default async function AdminLayout({
  children
}: {
  children: React.ReactNode
}) {
  const { success, user } = await getLoggedInUser()

  // Dobbeltsjekk admin-rolle (proxy sjekker ogsÃ¥)
  if (!success || !user || user.role !== "admin") {
    redirect("/dashboard")
  }

  return (
    &lt;div className="min-h-screen flex"&gt;
      {/* Admin sidebar */}
      &lt;AdminSidebar /&gt;

      {/* Hovedinnhold */}
      &lt;main className="flex-1 p-8 bg-gray-100"&gt;
        {children}
      &lt;/main&gt;
    &lt;/div&gt;
  )
}</code></pre>

    <!-- ============================================ -->
    <!-- DYNAMISK RUTING -->
    <!-- ============================================ -->
    <h2 id="dynamisk-ruting">Dynamisk Ruting: [id], [slug], [...catchAll]</h2>

    <p>Dynamiske ruter lar deg lage sider basert pÃ¥ URL-parametre:</p>

    <div class="folder-tree">
<span class="folder">src/app/</span>
â”œâ”€â”€ <span class="folder">produkter/</span>
â”‚   â”œâ”€â”€ <span class="file">page.tsx</span>              <span class="comment"># /produkter (liste)</span>
â”‚   â””â”€â”€ <span class="special">[id]/</span>                 <span class="comment"># Dynamisk segment</span>
â”‚       â”œâ”€â”€ <span class="file">page.tsx</span>          <span class="comment"># /produkter/123</span>
â”‚       â””â”€â”€ <span class="folder">rediger/</span>
â”‚           â””â”€â”€ <span class="file">page.tsx</span>      <span class="comment"># /produkter/123/rediger</span>
â”‚
â”œâ”€â”€ <span class="folder">blogg/</span>
â”‚   â”œâ”€â”€ <span class="file">page.tsx</span>              <span class="comment"># /blogg (alle innlegg)</span>
â”‚   â””â”€â”€ <span class="special">[slug]/</span>               <span class="comment"># URL-vennlig ID</span>
â”‚       â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># /blogg/min-forste-post</span>
â”‚
â”œâ”€â”€ <span class="folder">docs/</span>
â”‚   â””â”€â”€ <span class="special">[...slug]/</span>            <span class="comment"># Catch-all (flere segmenter)</span>
â”‚       â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># /docs/guide/getting-started</span>
â”‚
â””â”€â”€ <span class="folder">kategorier/</span>
    â””â”€â”€ <span class="special">[[...slug]]/</span>          <span class="comment"># Optional catch-all</span>
        â””â”€â”€ <span class="file">page.tsx</span>          <span class="comment"># /kategorier ELLER /kategorier/mat/pizza</span>
    </div>

    <h3><span class="step-indicator">1</span>Enkel Dynamisk Rute: [id]</h3>

    <div class="file-path">src/app/produkter/[id]/page.tsx</div>
    <pre><code>import { notFound } from "next/navigation"
import { getProductById } from "@/actions/products"
import Image from "next/image"
import Link from "next/link"

// TypeScript: Definer params-typen
interface PageProps {
  params: Promise&lt;{ id: string }&gt;
}

// Generer statiske sider for kjente produkter (valgfritt)
export async function generateStaticParams() {
  // Hent alle produkt-IDer for static generation
  const { data: products } = await getProducts()

  return products?.map((product) => ({
    id: product.id,
  })) || []
}

// Dynamisk metadata basert pÃ¥ produkt
export async function generateMetadata({ params }: PageProps) {
  const { id } = await params
  const { data: product } = await getProductById(id)

  return {
    title: product?.name || "Produkt ikke funnet",
    description: product?.description || "Ingen beskrivelse",
  }
}

export default async function ProductPage({ params }: PageProps) {
  // Hent ID fra URL (Next.js 15: params er async)
  const { id } = await params

  // Hent produktdata
  const { success, data: product } = await getProductById(id)

  // Vis 404 hvis ikke funnet
  if (!success || !product) {
    notFound()
  }

  return (
    &lt;div className="max-w-4xl mx-auto p-8"&gt;
      {/* Breadcrumbs */}
      &lt;nav className="text-sm text-gray-500 mb-6"&gt;
        &lt;Link href="/produkter" className="hover:text-blue-600"&gt;Produkter&lt;/Link&gt;
        &lt;span className="mx-2"&gt;/&lt;/span&gt;
        &lt;span&gt;{product.name}&lt;/span&gt;
      &lt;/nav&gt;

      {/* Produktdetaljer */}
      &lt;div className="grid md:grid-cols-2 gap-8"&gt;
        {/* Bilde */}
        &lt;div className="relative aspect-square bg-gray-100 rounded-xl overflow-hidden"&gt;
          {product.image_url ? (
            &lt;Image
              src={product.image_url}
              alt={product.name}
              fill
              className="object-cover"
            /&gt;
          ) : (
            &lt;div className="flex items-center justify-center h-full text-gray-400"&gt;
              Ingen bilde
            &lt;/div&gt;
          )}
        &lt;/div&gt;

        {/* Info */}
        &lt;div&gt;
          &lt;h1 className="text-3xl font-bold mb-4"&gt;{product.name}&lt;/h1&gt;

          &lt;p className="text-3xl font-bold text-green-600 mb-6"&gt;
            {product.price.toLocaleString("no-NO")} kr
          &lt;/p&gt;

          &lt;p className="text-gray-600 mb-8"&gt;
            {product.description || "Ingen beskrivelse"}
          &lt;/p&gt;

          &lt;div className="flex gap-4"&gt;
            &lt;button className="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700"&gt;
              Legg i handlekurv
            &lt;/button&gt;
            &lt;Link
              href={`/produkter/${id}/rediger`}
              className="px-6 py-3 border-2 border-gray-200 rounded-lg hover:border-blue-600"
            &gt;
              Rediger
            &lt;/Link&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  )
}</code></pre>

    <h3><span class="step-indicator">2</span>Catch-All Rute: [...slug]</h3>

    <div class="file-path">src/app/docs/[...slug]/page.tsx</div>
    <pre><code>interface PageProps {
  params: Promise&lt;{ slug: string[] }&gt;
}

export default async function DocsPage({ params }: PageProps) {
  const { slug } = await params
  // slug er en array:
  // /docs/guide           â†’ slug = ["guide"]
  // /docs/guide/start     â†’ slug = ["guide", "start"]
  // /docs/api/auth/login  â†’ slug = ["api", "auth", "login"]

  const path = slug.join("/")

  return (
    &lt;div&gt;
      &lt;h1&gt;Dokumentasjon: {path}&lt;/h1&gt;
      &lt;p&gt;Segmenter: {slug.join(" â†’ ")}&lt;/p&gt;
    &lt;/div&gt;
  )
}</code></pre>

    <h3><span class="step-indicator">3</span>Rediger-side: [id]/rediger</h3>

    <div class="file-path">src/app/produkter/[id]/rediger/page.tsx</div>
    <pre><code>"use client"

import { useState, useEffect } from "react"
import { useParams, useRouter } from "next/navigation"
import { getProductById, updateProduct } from "@/actions/products"

export default function EditProductPage() {
  const params = useParams()
  const router = useRouter()
  const id = params.id as string

  const [product, setProduct] = useState&lt;any&gt;(null)
  const [loading, setLoading] = useState(true)
  const [saving, setSaving] = useState(false)

  // Hent eksisterende data
  useEffect(() => {
    async function fetchProduct() {
      const { data } = await getProductById(id)
      setProduct(data)
      setLoading(false)
    }
    fetchProduct()
  }, [id])

  async function handleSubmit(formData: FormData) {
    setSaving(true)
    const result = await updateProduct(id, formData)
    setSaving(false)

    if (result.success) {
      router.push(`/produkter/${id}`)
    }
  }

  if (loading) return &lt;div&gt;Laster...&lt;/div&gt;
  if (!product) return &lt;div&gt;Produkt ikke funnet&lt;/div&gt;

  return (
    &lt;div className="max-w-2xl mx-auto p-8"&gt;
      &lt;h1 className="text-2xl font-bold mb-6"&gt;Rediger: {product.name}&lt;/h1&gt;

      &lt;form action={handleSubmit} className="space-y-4"&gt;
        &lt;input
          type="text"
          name="name"
          defaultValue={product.name}
          className="w-full p-3 border rounded-lg"
        /&gt;

        &lt;input
          type="number"
          name="price"
          defaultValue={product.price}
          step="0.01"
          className="w-full p-3 border rounded-lg"
        /&gt;

        &lt;textarea
          name="description"
          defaultValue={product.description}
          rows={4}
          className="w-full p-3 border rounded-lg"
        /&gt;

        &lt;div className="flex gap-4"&gt;
          &lt;button
            type="submit"
            disabled={saving}
            className="flex-1 bg-blue-600 text-white py-3 rounded-lg"
          &gt;
            {saving ? "Lagrer..." : "Lagre endringer"}
          &lt;/button&gt;
          &lt;button
            type="button"
            onClick={() => router.back()}
            className="px-6 py-3 border rounded-lg"
          &gt;
            Avbryt
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  )
}</code></pre>

    <!-- ============================================ -->
    <!-- PRAKTISKE EKSEMPLER -->
    <!-- ============================================ -->
    <h2 id="praktisk">Praktiske Eksempler: Fullstendige Flows</h2>

    <h3>Eksempel 1: Produktliste med CRUD</h3>

    <div class="architecture-diagram">
      <h3>Komplett Flow: ProdukthÃ¥ndtering</h3>
<pre style="margin:0; color: #e2e8f0;">
<span style="color: #60a5fa;">URL</span>                      <span style="color: #f59e0b;">Side</span>                         <span style="color: #22c55e;">Funksjon</span>
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/produkter              page.tsx                     Liste alle
/produkter/ny           ny/page.tsx                  Opprett form
/produkter/[id]         [id]/page.tsx                Vis detaljer
/produkter/[id]/rediger [id]/rediger/page.tsx        Rediger form

<span style="color: #60a5fa;">Server Actions (src/actions/products.ts)</span>
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
getProducts()           â†’ Hent alle
getProductById(id)      â†’ Hent Ã©n
createProduct(formData) â†’ Opprett ny
updateProduct(id, data) â†’ Oppdater
deleteProduct(id)       â†’ Slett
</pre>
    </div>

    <h3>Eksempel 2: Brukerautentisering Flow</h3>

    <div class="architecture-diagram">
      <h3>Auth Flow med Proxy</h3>
<pre style="margin:0; color: #e2e8f0;">
<span style="color: #4ade80;">1. REGISTRERING</span>
   Bruker â†’ /register â†’ register() action â†’ Database â†’ Cookie settes

<span style="color: #4ade80;">2. INNLOGGING</span>
   Bruker â†’ /login â†’ login() action â†’ Verifiser passord â†’ JWT i cookie

<span style="color: #4ade80;">3. BESÃ˜KER BESKYTTET SIDE</span>
   Bruker â†’ /dashboard
         â†“
   <span style="color: #f59e0b;">Proxy sjekker:</span>
   - Har cookie? âœ“
   - Gyldig JWT? âœ“
   - Ikke utlÃ¸pt? âœ“
         â†“
   Dashboard vises

<span style="color: #4ade80;">4. ADMIN-TILGANG</span>
   Bruker â†’ /admin
         â†“
   <span style="color: #f59e0b;">Proxy sjekker:</span>
   - Har cookie? âœ“
   - Gyldig JWT? âœ“
   - role === "admin"? <span style="color: #ef4444;">âœ—</span>
         â†“
   Redirect â†’ /dashboard
</pre>
    </div>

    <h3>Eksempel 3: Webhook fra Stripe</h3>

    <div class="file-path">src/app/api/webhook/stripe/route.ts</div>
    <pre><code>import { NextRequest, NextResponse } from "next/server"
import Stripe from "stripe"
import supabase from "@/config/supabase-config"

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!)
const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET!

export async function POST(request: NextRequest) {
  const body = await request.text()
  const signature = request.headers.get("stripe-signature")!

  let event: Stripe.Event

  try {
    // Verifiser at webhook kommer fra Stripe
    event = stripe.webhooks.constructEvent(body, signature, webhookSecret)
  } catch (error) {
    console.error("Webhook signature verification failed")
    return NextResponse.json({ error: "Invalid signature" }, { status: 400 })
  }

  // HÃ¥ndter ulike event-typer
  switch (event.type) {
    case "checkout.session.completed":
      const session = event.data.object as Stripe.Checkout.Session

      // Oppdater ordre i database
      await supabase
        .from("orders")
        .update({
          status: "paid",
          stripe_session_id: session.id
        })
        .eq("id", session.metadata?.orderId)

      break

    case "payment_intent.payment_failed":
      // HÃ¥ndter feilet betaling
      break
  }

  return NextResponse.json({ received: true })
}</code></pre>

    <!-- OPPSUMMERING -->
    <div class="success-box" style="margin-top: 3rem;">
      <h3 style="margin-top: 0;">Oppsummering</h3>
      <table style="width: 100%; margin-top: 1rem;">
        <tr>
          <td><strong>Server Actions</strong></td>
          <td>Bruk for skjemaer og CRUD (90% av tilfellene)</td>
        </tr>
        <tr>
          <td><strong>API Routes</strong></td>
          <td>Bruk for webhooks og eksterne API-er</td>
        </tr>
        <tr>
          <td><strong>Proxy</strong></td>
          <td>Bruk for auth-sjekk og rutebeskyttelse</td>
        </tr>
        <tr>
          <td><strong>Route Groups</strong></td>
          <td>Bruk for Ã¥ organisere med delte layouts</td>
        </tr>
        <tr>
          <td><strong>[id]</strong></td>
          <td>Bruk for dynamiske sider (produkt, bruker, etc.)</td>
        </tr>
        <tr>
          <td><strong>[...slug]</strong></td>
          <td>Bruk for catch-all (docs, kategorier)</td>
        </tr>
      </table>
    </div>

    <h2>Neste steg</h2>
    <table>
      <thead>
        <tr>
          <th>Ressurs</th>
          <th>Beskrivelse</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><a href="fullstack-arkitektur.html"><strong>Fullstack Arkitektur</strong></a></td>
          <td>Komplett mappestruktur og auth-system</td>
        </tr>
        <tr>
          <td><a href="database.html">Database (Supabase)</a></td>
          <td>Tabeller, SQL, RLS-policies</td>
        </tr>
        <tr>
          <td><a href="autentisering.html">Autentisering</a></td>
          <td>Login, register, JWT-hÃ¥ndtering</td>
        </tr>
        <tr>
          <td><a href="admin.html">Admin Panel</a></td>
          <td>Dashboard og admin-funksjonalitet</td>
        </tr>
      </tbody>
    </table>

    <div class="footer">
      <p><a href="fullstack-arkitektur.html">â† Fullstack Arkitektur</a> | <a href="database.html">Database â†’</a></p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
        <a href="https://obligarconsulting.no" target="_blank" style="color: #2563eb;">Obligar Consulting</a>
      </p>
    </div>
  </div>

  <script src="../assets/copy-code.js"></script>
</body>
</html>
